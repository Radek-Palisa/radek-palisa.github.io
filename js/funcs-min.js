"use strict";var _createClass=function(){function a(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(t,e,i){return e&&a(t.prototype,e),i&&a(t,i),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Tracker=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"create",value:function(t){return this.el=document.createElement("div"),this.el.className=t.cssClass,t.container.insertBefore(this.el,void 0),this.calculateInitialHeightAdjustValue(t.lastControl),this}},{key:"calculateInitialHeightAdjustValue",value:function(t){this.initialHeightAdjustValue=(t.offsetHeight+2*getStyleValueInt(t,"margin-top")+getStyleValueInt(t,"margin-bottom"))/2+getStyleValueInt(this.el,"top")+4}},{key:"adjustInitialHeightInRelationTo",value:function(t){this.el.style.height=t-this.initialHeightAdjustValue+"px"}},{key:"adjustCurrentHeightBy",value:function(t){this.el.style.height=parseFloat(this.el.style.height)+t+"px"}}]),t}(),Accordion=function(){function e(t){_classCallCheck(this,e),this.outerWrapperClass=t.outerWrapperClass,this.wrapperClass=t.wrapperClass,this.itemClass=t.itemClass,this.headersClass=t.headersClass,this.panelsClass=t.panelsClass,this.trackerClass=t.trackerClass,this.transitionSpeed=t.speed,this.firstToBeExpanded=t.firstToBeExpanded,this.panelData=[]}return _createClass(e,[{key:"init",value:function(){this.initPanelData(this.firstToBeExpanded),this.cacheDOMelements(),this.setControlIdentifiers(),this.outerWrapper.classList.add(this.outerWrapperClass+"-js"),this.tracker=(new Tracker).create({cssClass:this.trackerClass,container:this.wrapper,lastControl:this.controls[this.controls.length-1]}),this.setHeights(),this.setListeners(),setAriaRoles(this.controls,this.panelData.map(function(t){return t.el}))}},{key:"initPanelData",value:function(a){var s=this;Array.prototype.slice.call(document.querySelectorAll("."+this.panelsClass)).forEach(function(t,e){var i={idx:e,el:t,isExpanded:!(!a||0!==e),height:null};s.panelData.push(i)})}},{key:"cacheDOMelements",value:function(){this.outerWrapper=document.querySelector("."+this.outerWrapperClass),this.wrapper=document.querySelector("."+this.wrapperClass),this.controls=Array.prototype.slice.call(document.querySelectorAll("."+this.headersClass))}},{key:"setControlIdentifiers",value:function(){this.controls.forEach(function(t,e){t.setAttribute("data-id",e)})}},{key:"setListeners",value:function(){var e=this;this.controls.forEach(function(t){t.addEventListener("click",e.handleClick.bind(e))}),window.addEventListener("resize",debounce(this.setHeights,50).bind(this)),this.wrapper.addEventListener("keydown",function(){handleKeydown(event,e.controls)})}},{key:"setHeights",value:function(){var i=this;this.tracker.el.style.transition="none",this.panelData.forEach(function(t){var e=t.el.style;e.transition="none",t.height=t.el.firstElementChild.offsetHeight,e.height=t.isExpanded?t.height+"px":0,addCssTransitionWithDelay(t.el,"height",i.transitionSpeed)}),this.outerWrapper.style.minHeight="\n            "+(highestValueFrom(this.panelData.map(function(t){return t.height}))+sumFullHeightsOf(this.controls)+5)+"px \n        ",!1===this.panelData[this.panelData.length-1].isExpanded&&this.tracker.adjustInitialHeightInRelationTo(this.wrapper.offsetHeight),addCssTransitionWithDelay(this.tracker.el,"height",this.transitionSpeed)}},{key:"handleClick",value:function(t){var e=t.target.classList.contains(this.headersClass)?t.target:t.target.parentNode,i=parseFloat(e.getAttribute("data-id"));if(!0!==this.panelData[i].isExpanded){var a=this.panelData.filter(function(t){return!0===t.isExpanded})[0],s=a.height,n=this.panelData[i],r=n.height;togglePanelsHeight(a,n),i===this.panelData.length-1?this.tracker.adjustCurrentHeightBy(-s):(a.idx===this.panelData.length-1||this.tracker.adjustCurrentHeightBy(-s),this.tracker.adjustCurrentHeightBy(+r)),toggleAriaAttributes(this.controls,e,a,n),n.isExpanded=!0,a.isExpanded=!1}}}]),e}();function addCssTransitionWithDelay(t,e,i){setTimeout(function(){t.style.transition=e+" "+i+"ms"},i)}function elementHeightWithMargins(t){return t.offsetHeight+getStyleValueInt(t,"margin-top")+getStyleValueInt(t,"margin-bottom")}function debounce(a,s,n){var r;return function(){var t=this,e=arguments,i=n&&!r;clearTimeout(r),r=setTimeout(function(){r=null,n||a.apply(t,e)},s),i&&a.apply(t,e)}}function getStyleValueInt(t,e){return parseFloat(window.getComputedStyle(t).getPropertyValue(e).replace("px",""))}function handleKeydown(i,a){var s=i.target,t=i.which.toString(),e=i.ctrlKey&&t.match(/33|34/);if(s.classList.contains("accordion-trigger")){if(t.match(/38|40/)||e){var n=a.indexOf(s),r=t.match(/34|40/)?1:-1,l=a.length;a[(n+l+r)%l].focus(),i.preventDefault()}else if(t.match(/35|36/)){switch(t){case"36":a[0].focus();break;case"35":a[a.length-1].focus()}i.preventDefault()}}else e&&panels.forEach(function(t,e){t.contains(s)&&(a[e].focus(),i.preventDefault())})}function highestValueFrom(t){return t.reduce(function(t,e){return Math.max(t,e)})}function setAriaRoles(t,e){t.forEach(function(t,e){t.setAttribute("aria-controls","sec"+(e+1)),t.setAttribute("id","ctrl"+(e+1)),0===e?(t.setAttribute("aria-expanded","true"),t.setAttribute("aria-disabled","true")):(t.setAttribute("aria-expanded","false"),t.setAttribute("aria-disabled","false"))}),e.forEach(function(t,e){t.setAttribute("labelledby","ctrl"+(e+1)),t.setAttribute("id","sec"+(e+1)),t.setAttribute("role","region"),0===e?t.setAttribute("aria-hidden","false"):t.setAttribute("aria-hidden","true")})}function sumFullHeightsOf(t){return t.map(function(t){return elementHeightWithMargins(t)}).reduce(function(t,e){return t+e})}function toggleAriaAttributes(t,e,i,a){t[i.idx].setAttribute("aria-expanded","false"),t[i.idx].setAttribute("aria-disabled","false"),e.setAttribute("aria-disabled","true"),e.setAttribute("aria-expanded","true"),i.el.setAttribute("aria-hidden","true"),a.el.setAttribute("aria-hidden","false")}function togglePanelsHeight(t,e){t.el.style.height=0,e.el.style.height=e.height+"px"}window.onload=function(){new Accordion({wrapperClass:"accordion",outerWrapperClass:"accordion-outer",itemClass:"accordion-item",headersClass:"accordion-trigger",panelsClass:"accordion-content",trackerClass:"tracker",speed:"500",firstToBeExpanded:!0}).init()};